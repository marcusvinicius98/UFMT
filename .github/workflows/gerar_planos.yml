name: Gerar PDFs dos Planos de Ensino

on:
  workflow_dispatch:

jobs:
  gerar-pdfs:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout do código
      uses: actions/checkout@v3

    - name: Instalar dependências
      run: |
        sudo apt update
        sudo apt install -y wget unzip xvfb libnss3 libatk-bridge2.0-0 libxss1 libasound2 fonts-liberation libappindicator3-1 libgbm-dev libu2f-udev
        wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
        sudo dpkg -i google-chrome-stable_current_amd64.deb || sudo apt -f install -y
        pip install selenium PyPDF2

    - name: Baixar WebDriver
      run: |
        LATEST=$(curl -sSL https://chromedriver.storage.googleapis.com/LATEST_RELEASE)
        wget https://chromedriver.storage.googleapis.com/$LATEST/chromedriver_linux64.zip
        unzip chromedriver_linux64.zip
        sudo mv chromedriver /usr/local/bin/

    - name: Rodar script Python
      run: |
        xvfb-run --auto-servernum python3 scripts/gerar_pdfs.py

    - name: Upload dos PDFs por semestre
      uses: actions/upload-artifact@main
      with:
        name: planos-por-semestre
        path: pdfs_planos/*.pdf
